---
title: "Project 2"
author: "Yvette Callender"
date: "`r Sys.Date()`"
output: 
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Packages used in this project

```{r, message=FALSE}
library(tidyverse)
#library(httr)
library(jsonlite)
library(ggplot2)

```

# Introduction

The API chosen for investigation was data from the Center for Disease Control relating to [Vaccination Coverage among Adolescents](https://data.cdc.gov/Teen-Vaccinations/Vaccination-Coverage-among-Adolescents-13-17-Years/ee48-w5t6).  The dataset contains columns for vaccine, dose, geography type (national, regional, state, and local area), geography name, survey year, dimension type, dimension,estimate 95%CI, and sample size.  Dimension types include age, race/ethnicity, insurance coverage, poverty levels, proximity to an urban area, and overall.  This suggests areas of inquiry regarding things like:  

- geographical variation in vaccination coverage at regional level or state level  
- geographical variation in vaccination coverage differences due to  race/ethnicity or insurance coverage at the 
regional level and state level  
- variation in vaccination coverage based on the vaccine in question

The vaccines covered by the database include:

- HPV (human papillomavirus)  
- Menigococcal Conjugate  
- T or Td  (tetanus or tetanus/diptheria)  
- Tdap (tetanus, diptheria, and pertussis) (Replaced Td in 2005) 
- Varicella (chicken pox)  
- Hep A (hepatitis A)  
- MMR (measles, mumps, rubella)  
- HepB (hepatitis B)  

Parental attitudes may vary a great deal between these vaccines due to several factors such as perception of the threat being protected against (chicken pox not as serious as diptheria), whether the threat is associated with sexual behavior or drug use (HPV or HepB), and whether the vaccine has received particular attention from the anti-vaccination activists (MMR).  The HPV vaccine may also be perceived as more valuable to children who are assigned female at birth than those assigned male at birth. 

For HPV,the database uses the dose variable as way to track differential treatment of "male" and "female" children.

In this project, functions were developed to help users query the dataset about the following:

- HPV Vaccination Coverage: Regional level differences between genders with the option of changing dimension (race/ethnicity, poverty, insurance coverge, urbancity)  
- HPV Vaccination Coverage: Regional level differences in overall coverage estimate with the option of changing dimension (race/ethnicity, poverty, insurance coverage, urbancity)  
- Vaccination for Vaccines other than HPV: Regional level differences in coverage estimates with the option of changing vaccine and dimension  
- Vaccination for Vaccines other than HPV: State level differences in coverage estimates with the option of changing vaccine and dimension.  

Geographical information in the database is presented at a state level and at a regional level. The regions are listed [here](https://www.hhs.gov/about/agencies/iea/regional-offices/index.html). They are:

- 1: Connecticut, Maine, Massachusetts, New Hampshire, Rhode Island, and Vermont  
- 2: New Jersey, New York, Puerto Rico, and the Virgin Islands  
- 3: Delaware, District of Columbia, Maryland, Pennsylvania, Virginia, and West Virginia  
- 4: Alabama, Florida, Georgia, Kentucky, Mississippi, North Carolina, South Carolina, and Tennessee 
- 5: Illinois, Indiana, Michigan, Minnesota, Ohio, and Wisconsin  
- 6: Arkansas, Louisiana, New Mexico, Oklahoma, and Texas  
- 7: Iowa, Kansas, Missouri, and Nebraska  
- 8: Colorado, Montana, North Dakota, South Dakota, Utah, and Wyoming
- 9: Arizona, California, Hawaii, Nevada, American Samoa, Commonwealth of the Northern Mariana Islands, 
Federated States of Micronesia, Guam, Marshall Islands, and Republic of Palau  
- 10:Alaska, Idaho, Oregon, and Washington

These regions are shown visually here.




```{r}
#Get mapping data for states
map_data_1 <- map_data("state")

#Add HHS region info for states
map_data_2 <- as_tibble(map_data_1) %>%  mutate("HHS_region" =
      (if_else(region %in% c('connecticut', 'maine', 'massachusetts', 
                                'new hampshire', 'rhode island', 'vermont'),"1",
      if_else(region %in% c('new jersey', 'new york', "puerto rico", "u.s. virgin islands"),"2",
      if_else(region %in% c('delaware','district of columbia', 'maryland', 'pennsylvania', 'virginia',                                  'west virginia'),"3",
      if_else(region %in% c('alabama', 'florida','georgia','kentucky', 'mississippi','north carolina',                                  'south carolina','tennessee'),"4",
      if_else(region %in% c('illinois','indiana', 'michigan', 'minnesota', 'ohio', 
                               'wisconsin'),"5",
      if_else(region %in% c('arkansas', 'louisiana', 'oklahoma', 'new mexico','texas'),"6",
      if_else(region %in% c('iowa', 'kansas','missouri', 'nebraska'),"7",
      if_else(region %in% c('colorado', 'montana','north dakota', 'south dakota',  
                                'utah', 'wyoming'),"8",
      if_else(region %in% c('arizona', 'california', 'hawaii', 'nevada', "guam") ,"9",
      if_else(region %in% c('alaska', 'idaho', 'oregon', 
                               'washington') ,"10","error"))))))))))))

#Make plot
ggplot(map_data_2, aes (x = long, y = lat, group = group)) +
    geom_polygon(aes(fill = HHS_region), color = "black")+
    theme(axis.text = element_blank(),                  #removes lat and long labels and grid
          axis.ticks = element_blank(),
          axis.title = element_blank(),
          rect = element_blank())+
    labs(title = "HHS Regions for Contiental United States")+
    guides(fill = guide_legend(title = "HHS Regions"))+
    scale_fill_discrete(breaks = c('1','2','3', '4','5','6','7','8','9','10')) #Reorder legend
 
```

## Accessing Data

### Downloading data

The dataset for [Vaccination Coverage among Adolescents](https://data.cdc.gov/Teen-Vaccinations/Vaccination-Coverage-among-Adolescents-13-17-Years/ee48-w5t6) was converted from a JSON object to and R object using `fromJSON` which is in the `jsonlite` package.  The dataset currently contains >25,000 lines (which is greater than the default for from JSON), so the function call needed an explicit limit.  

```{r, cache=TRUE}

vaccine_API <- fromJSON("https://data.cdc.gov/resource/ee48-w5t6.json?$limit=50000") %>% as_tibble

#Verify the number of rows is less than 50000 (that the limit was sufficient to retrieve the complete dataset).

nrow(vaccine_API)
vaccine_API

```

### Function 1 for HPV Vaccination Coverage: Regional level differences between genders with user modification of year 

The function `HPV_gender_eval_function` selects the rows related to HPV vaccination  at the regional level or national. The user may specify a specific year.  Possible values for years are each year of `2006` through `2022`.  The function selects rows corresponding to the coverage estimates for up to date vaccination of each of males and females in 13-17 year age range.

```{r, Function 1 for looking at HPV data-regional level }
HPV_gender_eval_function <- function(year_of_interest = "2022" ){
  
#Check input type
      if (!(year_of_interest %in% c('2006','2007','2008','2009','2010','2011','2012','2013','2014','2015',
                                    '2016','2017','2018','2019','2020','2021','2022'))) stop
        ("Year out of range, choose a year between 2006 and 2022 (inclusive).")
         
                            vaccine_API %>% 
                            filter(vaccine == "HPV" & geography_type == "HHS Regions/National") %>%  #Select vaccine=HPV and National/Regional Level
                            filter(year_season == year_of_interest) %>%                              #Filter Year based on user request
                            filter((dose == "Up-to-Date, Females")| (dose == "Up-to-Date, Males")) %>%  
                            filter(dimension == "13-17 Years")
}

```

A demonstration of the function (`HPV_gender_eval_function`) is given below.
```{r, demonstration of Function 1, message=TRUE, warning=TRUE}
demo_function_1 <- HPV_gender_eval_function(year_of_interest ="2021")
demo_function_1
```

A demonstration of the results from this function call transformed into a user-friendly table is given below.

```{r, table using data from Function 1, rows.print=11}
demo_function_1a <- demo_function_1 %>%select(geography, dose, coverage_estimate) %>% 
                   mutate (coverage_estimate=as.numeric(coverage_estimate)) %>% #to allow calculation of difference
                   pivot_wider(names_from=dose, values_from=(coverage_estimate)) 

#Rename columns for ease of reference in mutate 
colnames(demo_function_1a) <-c ("geography",  "cov_est_female", "cov_est_male")

#Add a column for difference between genders
demo_function_1a <- mutate(demo_function_1a, "Diff"=cov_est_female-cov_est_male)
demo_function_1a


```

*Considered on a national level, the difference between male and female vaccination rates is less than 5%. But in Regions 2 and 5, the  difference seems "higher" at 9%, suggesting this  might be worth further investigation.
``{r}

### Function 2 for HPV Vaccination Coverage: State level differences between genders with user modification of year 

The function `HPV_gender_eval_function_state` selects the rows related to HPV vaccination  at the state/territory level . It makes use of the state.name dataset built into R combined with the territories with entries in the dataset (District of Columbia, Guam, Puerto Rico, and U.S. Virgin Islands).  Additionally The user may specify a specific year.  Possible values for years are each year of `2006` through `2022`.  The function selects rows corresponding to the coverage estimates for up to date vaccination of each of males and females in 13-17 year age range.

```{r, Function 2 for looking at HPV data-state level }
HPV_gender_eval_function_state <- function(year_of_interest = "2022" ){
  
#Check input type
#      if (!(year_of_interest %in% c('2006','2007','2008','2009','2010','2011','2012','2013','2014','2015',
#                                    '2016','2017','2018','2019','2020','2021','2022'))) stop
#       ("Year out of range, choose a year between 2006 and 2022 (inclusive).")
         
                            vaccine_API %>% 
                            filter((vaccine == "HPV") & 
                                     (geography %in% state.name | 
                                        geography %in% c("District of Columbia", "Guam", "Puerto Rico", "U.S. Virgin Islands","United States"))) %>%
                            filter(year_season == year_of_interest) %>%                              #Filter Year based on user request
                            filter((dose == "Up-to-Date, Females")| (dose == "Up-to-Date, Males")) %>%  
                            filter(dimension == "13-17 Years")
}

```


A demonstration of the function (`HPV_gender_eval_function_state`) is given below.
```{r, demonstration of Function 2,error=TRUE,  message=TRUE, warning=TRUE}
demo_function_2 <- HPV_gender_eval_function_state(year_of_interest ="2021")
demo_function_2
```

A demonstration of the results from this function call transformed into a user-friendly table is given below.

```{r, table using data from Function 2}
demo_function_2a <- demo_function_2 %>%select(geography, dose, coverage_estimate)%>% 
                   mutate (coverage_estimate=as.numeric(coverage_estimate)) %>%
                   pivot_wider(names_from=dose, values_from=coverage_estimate)

#Rename columns for ease of reference in mutate 
colnames(demo_function_2a) <-c ("geography",  "cov_est_female", "cov_est_male")

#Add a column for difference between genders
demo_function_2a <- mutate(demo_function_2a, "Diff"=cov_est_female-cov_est_male)
demo_function_2a
```

*States that have more than a 15% difference (absolute) in coverage rates (with a higher percent of females being vaccinated) include New Jersey, Tennessee, Virginia, and West Virginia.  At the other extreme, Kentucky has more than a 15% difference (absolute) in coverage with a higher percent of males vaccinated.  The quick look at the data suggests that further study of the gender differences in HPV vaccine coverage correlated with region might  be interesting.*  


### Function 3 for  Vaccination Coverage for Vaccines other than HPV: Regional Level Differences 

The function `vaccines_regional_eval_function` selects the rows related to  vaccination with vaccines other than HPV at the regional level.  Varicella data is also being excluded because the compliance data is separated into entries for teens with just vaccinations, those with a history of the disease and those with both. 

The user can select a `year_of_interest` to use in the analysis.  Possible values for years are each year of `2006` through `2022`.  The user may also select.  A default value of 2022 is provided for `year_of_interest`

The user can select a `vaccine_of_interest`.  Possible values include:

- "Meningococcal Conjugate"  
- "Td or Tdap"  
- "Tdap"  
- "Hep A"  
- "MMR"  
- "HepB" 

A default value of NULL is provided for `vaccine_of_interest` this will return data for all rows with the vaccines equal to any in the above list.

-

```{r, Function 3 for looking at data for vaccines other than HPV data-regional level  }
vaccines_regional_eval_function <- function(vaccine_of_interest = NULL, year_of_interest = "2022" ){
  
    #Check input type
    if (!(year_of_interest %in% c('2006','2007','2008','2009','2010','2011','2012','2013','2014','2015',
                                    '2016','2017','2018','2019','2020','2021','2022'))) stop
        ("Year out of range, choose a year between 2006 and 2022 (inclusive).")
         
    filtered_API <- vaccine_API %>% 
    filter(vaccine != "HPV" & vaccine != "Varicella"          #Select vaccine=not HPV or Varicella
           & geography_type == "HHS Regions/National") %>%    #Select National/Regional Level
    filter(year_season == year_of_interest) %>%               #Filter Year based on user request
    filter (dimension =="13-17 Years")%>%                            #Filter age to allow comparison between vaccines
    mutate(coverage_estimate = as.numeric(coverage_estimate)) #Recast coverage_estimate to numeric 

    # filter for vaccine_of_interest if it is present, otherwise return all
    if (!is.null(vaccine_of_interest)) {
        filtered_API <- filtered_API %>% 
          filter(vaccine == vaccine_of_interest)
    }
    return(filtered_API)
}

```

A demonstration of the function (`vaccines_regional_eval_function`) is given below.

```{r, demonstration of Function 3 , message=TRUE, warning=TRUE}
demo_function_3 <- vaccines_regional_eval_function(year_of_interest = "2021")
```

Presentation of the results from this function call transformed into a user-friendly table is given below.

```{r, table using data from Function 3, rows.print=11}
demo_function_3a <- demo_function_3 %>%
                    select(geography, vaccine, coverage_estimate)%>% 
                    pivot_wider(names_from=vaccine, values_from=coverage_estimate)
demo_function_3a


```

*Based on this function call, it appears that vaccination coverage for Hepatitis A is lower than the other vaccines.  
[Immunization requiredments for secondary school](https://www.immunize.org/laws/hepa.asp) only include Hepatitis A in about half the states. This might be related.  Looking at the state data should include could show if lower rates of vaccination for Hepatitis A are observed only in states without a vaccination requirement. 


### Function 4 for  Vaccination Coverage for Vaccines other than HPV: State Level Differences 

The function `vaccines_state_eval_function` selects the rows related to  vaccination with vaccines other than HPV at the state level.  Varicella data is also being excluded because the compliance data is separated into entries for teens with just vaccinations, those with a history of the disease and those with both. 

The user can select a `year_of_interest` to use in the analysis.  Possible values for years are each year of `2006` through `2022`.  A default value of 2022 is provided for `year_of_interest`

The user can select a `vaccine_of_interest`.  Possible values include:

- "Meningococcal Conjugate"  
- "Td or Tdap"  
- "Tdap"  
- "Hep A"  
- "MMR"  
- "HepB" 

A default value of NULL is provided for `vaccine_of_interest` this will return data for all rows with the vaccines equal to any in the above list.

The user can select a `state_or_territory_of_interest`. Possible values include the fifty states as well as the territories with data present in the dataset (District of Columbia, Guam, Puerto Rico, and U.S. Virgin Islands.) A default value of NULL is provided for `state_of_interest` this will return data for all the states and territories.

```{r, Function 4 for looking at data for vaccines other than HPV or varicella data-state level  }
vaccines_state_eval_function <- function(vaccine_of_interest = NULL, state_of_interest=NULL, year_of_interest = "2022" ){
  
    #Check input type
    if (!(year_of_interest %in% c('2006','2007','2008','2009','2010','2011','2012','2013','2014','2015',
                                    '2016','2017','2018','2019','2020','2021','2022'))) 
       {stop
        ("Year out of range, choose a year between 2006 and 2022 (inclusive).")}
         
    filtered_API <- vaccine_API %>% 
    filter(vaccine != "HPV" & vaccine != "Varicella" &         #Select vaccine=not HPV or Varicella
          (geography %in% state.name | 
           geography %in% c("District of Columbia", "Guam", "Puerto Rico", "U.S. Virgin Islands"))) %>%
    filter(year_season == year_of_interest) %>%               #Filter Year based on user request
    filter (dimension =="13-17 Years")%>%                     #Filter age to allow easy comparison between vaccines
    mutate(coverage_estimate = as.numeric(coverage_estimate)) #Recast coverage_estimate to numeric 

    # filter for vaccine_of_interest if it is present, otherwise return all
    if (!is.null(vaccine_of_interest)) {
        filtered_API <- filtered_API %>% 
          filter(vaccine == vaccine_of_interest)
    }

    # filter for state_of_interest if it is present, otherwise return all
    if (!is.null(state_of_interest)) {
        filtered_API <- filtered_API %>% 
          filter(geography == state_of_interest)
    }

    return(filtered_API)
}
```

A demonstration of the function (`vaccines_state_eval_function`) is given below.

```{r, demonstration of Function 4 , message=TRUE, warning=TRUE}
demo_function_4 <- vaccines_state_eval_function(year_of_interest = "2021", state_of_interest="North Carolina")
demo_function_4
```

### Function 5 for  Vaccination Coverage 2018-2022 for Vaccines other than HPV or Varicella: State Level Differences 

The function `vaccines_4_year_function` selects the rows related to vaccination with vaccines other than HPV and Varicella at the state level.  
The user can select a `dimension_type_of_interest`. .

- "Insurance Coverage"  
- "Poverty"  
- "Race/Ethnicity "  
- "Urbanicity"  
- "Overall"  

The complete list of dimension types are only available for Tdap and Meningococcal Conjugate.  For other vaccines, only `Overall` is available.  The default value for `dimension_type_of_interest` is "Overall".

The user can select a `vaccine_of_interest`.  Possible values include:
- "Meningococcal Conjugate"  
- "Td or Tdap"  
- "Tdap"  
- "Hep A"  
- "MMR"  
- "HepB" 

A default value of NULL is provided for `vaccine_of_interest` this will return data for all rows with the vaccines equal to any in the above list.


```{r, Function 5 for looking at 4-year demographic data  }
vaccines_4_year_function <- function(dimension_type_of_interest="Overall",
                                     vaccine_of_interest = NULL){


         
    filtered_API <- vaccine_API %>% 
                    filter(year_season == "2018-2022") %>%                         #select the 4-year season
                    filter(vaccine != "HPV" & vaccine != "Varicella") %>%          #remove HPV and varicella
                    filter(dimension_type == dimension_type_of_interest) %>%       #select the dimension_type of interest
                    filter(geography %in% state.name |                             #remove metropolitan areas
                           geography %in% c("District of Columbia", "Guam", "Puerto Rico", "U.S. Virgin Islands", "United States")) %>%
                    mutate(coverage_estimate = as.numeric(coverage_estimate))      #Recast coverage_estimate to numeric 
    
    # filter for vaccine_of_interest if it is present, otherwise return all
    if (!is.null(vaccine_of_interest)) {
        filtered_API <- filtered_API %>% 
                        filter(vaccine == vaccine_of_interest)
    }
    return(filtered_API)
}
```

A demonstration of the function (`vaccines_4_year_function`) is given below.

```{r, demonstration of Function 5 , message=TRUE, warning=TRUE}
demo_function_5 <- vaccines_4_year_function(dimension_type_of_interest = "Insurance Coverage", vaccine_of_interest = "Meningococcal Conjugate")
demo_function_5
unique(demo_function_5$vaccine)
unique(demo_function_5$dimension)
```

Presentation of the results from this function call transformed into a user-friendly table is given below.

```{r, table using data from Function 5, rows.print=52}

demo_function_5a <- demo_function_5 %>%
                    select(geography, dimension, coverage_estimate) %>%
                    pivot_wider(names_from = dimension, values_from = coverage_estimate)

demo_function_5a
```


### Summary of Functions 

Five functions were developed to do the following:

- Function 1: Obtain regional data About differences in HPV vaccination coverage between genders; user can specify year  
- Function 2: Obtain state sata about differences in HPV vaccination coverage between genders; user can specify year  
- Function 3: Obtain regional data about vaccination coverage for meningococcal disease, tetanus, diptheria, pertussis, hepatitis A, measles, mumps, rubella, and hepatitis B; the user can specify a year and a vaccine  
- Function 4: Obtain state data about vaccination coverage for meningococcal disease, tetanus, diptheria, pertussis, hepatitis A, measles, mumps, rubella, and hepatitis B; the user can specify a year , a vaccine, and a state  
- Function 5: Obtain state data about vaccination data for the Tdap and meningococcal vaccine for the 2018-2022 time frame sorted by dimension (insurance coverage, poverty, race/ethnicity, urbanicity, and overall); the user may specify a vaccine and a dimension.  

## Exploratory Data Analysis

### Comparing Vaccine Coverage for Tdap and Meningococcal Conjugate

While all states require Tdap vaccination for secondary school attendance, only 35 states require vaccination with the meningococcal conjugate for secondary school attendance.  A possible line of inquiry is does this difference lead to lower vaccine coverage for meningococcal conjugate. Data will be obtained for this using Function 5. The function will be called with all vaccines and overall for the dimension.  The other vaccines will be filtered out and then the table will be pivoted to a wide format.

```{r, compare Tdap and menigococcal }
coverage_comparison_1 <- vaccines_4_year_function () %>%
              filter(vaccine == "Tdap" | vaccine == "Meningococcal Conjugate") %>%
              select (geography, vaccine, coverage_estimate) %>%
              pivot_wider(names_from = vaccine, values_from = coverage_estimate)

#Change columns names to eliminate illegal characters introduced in pivot operation

colnames(coverage_comparison_1) <- c("geography", "Meningococcal_conjugate", "Tdap")

coverage_comparison_1

#Print quantile summaries
summary(coverage_comparison_1[2])
summary(coverage_comparison_1[3])
```

The data for vaccination with the meningococcal conjugate does appear more spread out.  

### Vaccine Coverage for Meningococcal Conjugate by State Requirements

To see if the spread in coverage for mengicoccal disease is related to [requirements for secondary school attendance] (https://www.immunize.org/laws/menin_sec.asp), a column will be added to the data giving the regulatory status (as a categorical variable) and then that will be used for comparison.  Since vaccination is not mandated at a federal level, it is also filtered out.

```{r}
#States not requiring vaccination with meningococcal conjugate
mening_not_required <- c("Alabama","Alaska","California", "Colorado", "Florida", "Mississippi", "Montana",
                         "Nebraska", "New Hampshire", "Oklahoma", "Oregon", "South Carolina", "Tennessee",
                         "Washington", "Wyoming" )


meningococcal_regulation_analysis <- coverage_comparison_1 %>%
                                     select(!Tdap) %>%                          #remove Tdap column
                                     filter(geography != "United States") %>%   #remove US row
                                     mutate(mening_req = if_else                #create new variable
                                            (geography %in% mening_not_required, 
                                             "No", 
                                             "Yes")) %>%
                                     select(geography, mening_req, Meningococcal_conjugate) #reorder columns

#Set the regulatory status to be a factor
meningococcal_regulation_analysis$mening_req <-as.factor(meningococcal_regulation_analysis$mening_req)

meningococcal_regulation_analysis
```

This data set can be visualized using a boxplot.

```{r, boxplot}
#Boxplots comparing states with and without  requirements for secondary school attendance
graph_1 <- ggplot(meningococcal_regulation_analysis, aes(x = mening_req, y = Meningococcal_conjugate))
graph_1 + geom_boxplot(fill='gray')+
  labs( x = "Vaccination Required for Secondary School",
        y = "Vaccination Coverage Estimate",
        title = "Variation in Coverage Estimate for Meningococcal Disease",
        subtitle = "by if State Requires Vaccination for Secondary School Attendance")
```

The boxplots show a considerable difference in vaccination coverage rates between states with and without a vaccination requirement for secondary school.  

It is interesting to consider if the parental choice to vaccinate children is influenced by some other factor when vaccination is not mandated for school attendance.  The data allows evaluation using insurance coverage, poverty,race/ethnicity, and urbanicity. 

###  Vaccine Coverage for Meningococcal Conjugate in States without Mandates 

Analyses were performed to determine if coverage estimates for meningococcal disease are affected by the factors insurance coverage, poverty, race/ethnicity, and urbanicity.  Function 5 was used, selecting for meningococcal conjugate and the appropriate dimension, working through them consecutively.
Data for states with vaccination requirements for secondary school were filtered out.  The dimension data was recast as factors and a box plots generated.

```{r, compare menigococcal using insurance}

insurance_comparison_1 <- vaccines_4_year_function(dimension_type_of_interest = "Insurance Coverage",
                                                   vaccine_of_interest = "Meningococcal Conjugate") %>%
                          select(geography, dimension, coverage_estimate) %>%
                          filter(geography %in% mening_not_required) 
insurance_comparison_1 

insurance_comparison_1$dimension<- as.factor(insurance_comparison_1$dimension)

graph_2 <- ggplot(insurance_comparison_1, aes(x = dimension, y = coverage_estimate))
graph_2 + geom_boxplot(fill='gray')+
  labs( x = "Insurance Coverage",
        y = "Vaccination Coverage Estimate",
        title = "Variation in Coverage Estimate for Meningococcal Disease with Insurance",
        subtitle = "In  States without Vaccination Requirements for Secondary School Attendance")
```

```{r, compare menigococcal using poverty}

poverty_comparison_1 <- vaccines_4_year_function(dimension_type_of_interest = "Poverty",
                                                   vaccine_of_interest = "Meningococcal Conjugate") %>%
                          select(geography, dimension, coverage_estimate) %>%
                          filter(geography %in% mening_not_required) 

poverty_comparison_1$dimension<- as.factor(poverty_comparison_1$dimension)

graph_3 <- ggplot(poverty_comparison_1, aes(x = dimension, y = coverage_estimate))
graph_3 + geom_boxplot(fill='gray')+
  labs( x = "Poverty",
        y = "Vaccination Coverage Estimate",
        title = "Variation in Coverage Estimate for Meningococcal Disease with Poverty Level",
        subtitle = "In  States without Vaccination Requirements for Secondary School Attendance")
```

```{r, compare menigococcal using race/ethnicity}

ethnicity_comparison_1 <- vaccines_4_year_function(dimension_type_of_interest = "Race/Ethnicity ",
                                                   vaccine_of_interest = "Meningococcal Conjugate") %>%
                          select(geography, dimension, coverage_estimate) %>%
                          filter(geography %in% mening_not_required) 

ethnicity_comparison_1$dimension<- as.factor(ethnicity_comparison_1$dimension)

graph_4 <- ggplot(ethnicity_comparison_1, aes(x = dimension, y = coverage_estimate))
graph_4 + geom_boxplot(fill='gray')+
  labs( x = "Race/Ethnicity",
        y = "Vaccination Coverage Estimate",
        title = "Variation in Coverage Estimate for Meningococcal Disease with Race/Ethnicity",
        subtitle = "In  States without Vaccination Requirements for Secondary School Attendance")
```


```{r, compare menigococcal using urbanicity}

urbanicity_comparison_1 <- vaccines_4_year_function(dimension_type_of_interest = "Urbanicity",
                                                   vaccine_of_interest = "Meningococcal Conjugate") %>%
                          select(geography, dimension, coverage_estimate) %>%
                          filter(geography %in% mening_not_required) 

urbanicity_comparison_1$dimension<- as.factor(urbanicity_comparison_1$dimension)

urbanicity_comparison_1 

graph_5 <- ggplot(urbanicity_comparison_1, aes(x = dimension, y = coverage_estimate))
graph_5 + geom_boxplot(fill='gray')+
  labs( x = "Urbanicity",
        y = "Vaccination Coverage Estimate",
        title = "Variation in Coverage Estimate for Meningococcal Disease with Urbanicity",
        subtitle = "In  States without Vaccination Requirements for Secondary School Attendance")
```


Comparing these four boxplots, it appears that of the factors studied insurance coverage has the largest impact on vaccination.  Specifically lower vaccination coverage is observed in the uninsured.  The plots on urbanicity suggest that living in a non-metropolitan statistical area also lowers the rate of vaccination


###  Vaccine Coverage for Vaccines by Region
